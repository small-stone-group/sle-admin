<html>
<!-- License:  LGPL 2.1 or QZ INDUSTRIES SOURCE CODE LICENSE -->
<head><title>QZ Print Plugin</title>
<script type="text/javascript" src="qz-print/dist/js/deployJava.js"></script>
<script type="text/javascript">
	/**
	* Optionally used to deploy multiple versions of the applet for mixed
	* environments.  Oracle uses document.write(), which puts the applet at the
	* top of the page, bumping all HTML content down.
	*/
	deployQZ();
	
	/**
	* Deploys different versions of the applet depending on Java version.
	* Useful for removing warning dialogs for Java 6.  This function is optional
	* however, if used, should replace the <applet> method.  Needed to address 
	* MANIFEST.MF TrustedLibrary=true discrepency between JRE6 and JRE7.
	*/
	function deployQZ() {
		var attributes = {id: "qz", code:'qz.PrintApplet.class', 
			archive:'qz-print.jar', width:1, height:1};
		var parameters = {jnlp_href: 'qz-print_jnlp.jnlp', 
			cache_option:'plugin', disable_logging:'false', 
			initial_focus:'false'};
		if (deployJava.versionCheck("1.7+") == true) {}
		else if (deployJava.versionCheck("1.6+") == true) {
			delete parameters['jnlp_href'];
		}
		deployJava.runApplet(attributes, parameters, '1.5');
	}
	
	/**
	* Automatically gets called when applet has loaded.
	*/
	function qzReady() {
		// Setup our global qz object
		window["qz"] = document.getElementById('qz');
		var title = document.getElementById("title");
		if (qz) {
			try {
				title.innerHTML = title.innerHTML + " " + qz.getVersion();
				document.getElementById("content").style.background = "#F0F0F0";
			} catch(err) { // LiveConnect error, display a detailed meesage
				document.getElementById("content").style.background = "#F5A9A9";
				alert("ERROR:  \nThe applet did not load correctly.  Communication to the " + 
					"applet has failed, likely caused by Java Security Settings.  \n\n" + 
					"CAUSE:  \nJava 7 update 25 and higher block LiveConnect calls " + 
					"once Oracle has marked that version as outdated, which " + 
					"is likely the cause.  \n\nSOLUTION:  \n  1. Update Java to the latest " + 
					"Java version \n          (or)\n  2. Lower the security " + 
					"settings from the Java Control Panel.");
		  }
	  }
	}
	
	/**
	* Returns whether or not the applet is not ready to print.
	* Displays an alert if not ready.
	*/
	function notReady() {
		// If applet is not loaded, display an error
		if (!isLoaded()) {
			return true;
		}
		// If a printer hasn't been selected, display a message.
		else if (!qz.getPrinter()) {
			alert('Please select a printer first by using the "Detect Printer" button.');
			return true;
		}
		return false;
	}
	
	/**
	* Returns is the applet is not loaded properly
	*/
	function isLoaded() {
		if (!qz) {
			alert('Error:\n\n\tPrint plugin is NOT loaded!');
			return false;
		} else {
			try {
				if (!qz.isActive()) {
					alert('Error:\n\n\tPrint plugin is loaded but NOT active!');
					return false;
				}
			} catch (err) {
				alert('Error:\n\n\tPrint plugin is NOT loaded properly!\n\n\tJava Applet Blocked');
				return false;
			}
		}
		return true;
	}
	
	/**
	* Automatically gets called when "qz.print()" is finished.
	*/
	function qzDonePrinting() {
		// Alert error, if any
		if (qz.getException()) {
			alert('Error printing:\n\n\t' + qz.getException().getLocalizedMessage());
			qz.clearException();
			return; 
		}
		
		// Alert success message
		alert('Successfully sent print data to "' + qz.getPrinter() + '" queue.');
	}
	function findPrinter(name) {
		// Get printer name from input box
		var p = document.getElementById('printer');
		if (name) {
			p.value = name;
		}
		
		if (isLoaded()) {
			// Searches for locally installed printer with specified name
			qz.findPrinter(p.value);
			
			// Automatically gets called when "qz.findPrinter()" is finished.
			window['qzDoneFinding'] = function() {
				var p = document.getElementById('printer');
				var printer = qz.getPrinter();
				
				// Alert the printer name to user
				alert(printer !== null ? 'Printer found: "' + printer + 
					'" after searching for "' + p.value + '"' : 'Printer "' + 
					p.value + '" not found.');
				
				// Remove reference to this function
				window['qzDoneFinding'] = null;
			};
		}
	}
	function printHTML() {
		if (notReady()) { return; }
		
		// Preserve formatting for white spaces, etc.
		var colA = fixHTML('<h2>*  Shortlanesend Store  *</h2>');
		colA = colA + '<color=red>Version:</color> ' + qz.getVersion() + '<br />';
		colA = colA + '<color=red>Visit:</color> http://code.google.com/p/jzebra';
		
		// HTML image
		var colB = '<img src="' + getPath() + 'img/image_sample.png">';
		
                //qz.setCopies(3);
		qz.setCopies(parseInt(document.getElementById("copies").value));
                
		// Append our image (only one image can be appended per print)
		qz.appendHTML('<html><table face="monospace" border="1px"><tr height="6cm">' + 
		'<td valign="top">' + colA + '</td>' + 
		'<td valign="top">' + colB + '</td>' + 
		'</tr></table></html>');
                
		qz.printHTML();
	}	
</script>
	<script type="text/javascript" src="qz-print/dist/js/jquery-1.10.2.js"></script>
	<script type="text/javascript" src="qz-print/dist/js/html2canvas.js"></script>
	<script type="text/javascript" src="qz-print/dist/js/jquery.plugin.html2canvas.js"></script>
	</head>
	<body id="content" bgcolor="#FFF380">
	<div style="position:absolute;top:0;left:5;"><h1 id="title">QZ Print Plugin</h1></div><br /><br /><br />
	<input type="button" onClick="printHTML()" value="Print HTML" /><br />
	<!--<table border="1px" cellpadding="5px" cellspacing="0px"><tr>

	<td valign="top"><h2>All Printers</h2>
	<input id="printer" type="text" value="zebra" size="15"><br />
	<input type="button" onClick="findPrinters()" value="List All Printers"><br />
	<input type="button" onClick="useDefaultPrinter()" value="Use Default Printer"><br /><br />
	 NEW QZ APPLET TAG USAGE -- RECOMMENDED -->
	<!--
	<applet id="qz" archive="./qz-print.jar" name="QZ Print Plugin" code="qz.PrintApplet.class" width="55" height="55">
	<param name="jnlp_href" value="qz-print_jnlp.jnlp">
	<param name="cache_option" value="plugin">
	<param name="disable_logging" value="false">
	<param name="initial_focus" value="false">
	</applet><br />
	-->
	
	<!-- OLD JZEBRA TAG USAGE -- FOR UPGRADES -->
    <!-- 
	<applet name="jzebra" archive="./qz-print.jar" code="qz.PrintApplet.class" width="55" height="55">
	<param name="jnlp_href" value="qz-print_jnlp.jnlp">
	<param name="cache_option" value="plugin">
	<param name="disable_logging" value="false">
	<param name="initial_focus" value="false">
	<param name="printer" value="zebra">
	</applet><br />
	

	</td><td valign="top"><h2>Raw Printers Only</h2>
	<a href="http://qzindustries.com/WhatIsRawPrinting" target="new">What is Raw Printing?</a><br /><br />
	<input type="button" onClick="printEPL()" value="Print EPL" /><br />
	<input type="button" onClick="printZPL()" value="Print ZPL" /><br /><br />
	<input type="button" onClick="printESCP()" value="Print ESCP" /><br />
		<a href="javascript:findPrinter('Epson');">Epson</a>&nbsp;
		<a href="javascript:findPrinter('Citizen');">Citizen</a>&nbsp;
		<a href="javascript:findPrinter('Star');">Star</a> <br /><br /> 
	<input type="button" onClick="printEPCL()" value="Print EPCL" /><br />
		(Zebra Card Printer)<br /><br />
	<input type="button" onClick="print64()" value="Print Base64" /><br />
	<input type="button" onClick="printPages()" value="Print Spooling Every 2" /><br />
	<input type="button" onClick="printXML()" value="Print XML" /><br />
	<input type="button" onClick="printHex()" value="Print Hex" /><br /><br />
	<input type="button" onClick="printFile('zpl_sample.txt')" value="zpl_sample.txt" /><br />
	<input type="button" onClick="printFile('fgl_sample.txt')" value="fgl_sample.txt" /><br />
	<input type="button" onClick="printFile('epl_sample.txt')" value="epl_sample.txt" /><br /><br />

	<input type="button" onClick="printToFile()" value="Print To File" /><br />
	<input type="button" onClick="printToHost()" value="Print To Host" /><br />
	<input type="button" onClick="useAlternatePrinting()" value="Use Alternate Printing" /><br />

	</td><td valign="top"><h2>PostScript Printers Only</h2>
	<a href="http://qzindustries.com/WhatIsPostScriptPrinting" target="new">What is PostScript Printing?</a><br />
	<p>First find <a href="javascript:findPrinter('XPS');">Microsoft XPS</a> or <a href="javascript:findPrinter('PDF');">PDF</a> printer</p>
	<input type="button" onClick="printPDF()" value="Print PDF" /><br />
	<input type="button" onClick="printImage(false)" value="Print PostScript Image" /><br />
	<input type="button" onClick="printImage(true)" value="Print Scaled PostScript Image" /><br />
	<input type="button" onClick="printHTML5Page()" value="Print Current Page" /><br />
	<input type="button" onClick="logFeatures()" value="Log Printer Features on Print" /><br />
        <p>Copies<p>
        <input type="text" id="copies" size="8" value="1" />

	</td><td valign="top"><h2>Serial</h2>
	<input type="button" id="list_ports" onClick="listSerialPorts()" value="List Serial Ports" /><br />
	<input type="text" id="port_name" size="8" />
	<input type="button" id="open_port"  onClick="openSerialPort()" value="Open Port" /><br />
	<input type="button" id="send_data" onClick="sendSerialData()" value="Send Port Cmd" /><br />
	<input type="button" id="close_port"  onClick="closeSerialPort()" value="Close Port" /><br />
	<hr /><h2>Misc</h2>
	<input type="button" onClick="listNetworkInfo()" value="List Network Info" /><br />
	<input type="button" onClick="allowMultiple()" value="Allow Multiple Applets" /><br /></td></tr></table>-->
	</body><canvas id="hidden_screenshot" style="display:none;"></canvas>
</html>